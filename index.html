<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military & Medical Facilities Finder</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/logo.png">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>
                <span>Search Objects</span>
            </h1>

            <div class="form-group">
                <label>Latitude</label>
                <input type="number" id="latitude" placeholder="e.g.: 55.7558" step="0.0001" value="55.7558">
                <div class="validation-message" id="latError"></div>
            </div>

            <div class="form-group">
                <label>Longitude</label>
                <input type="number" id="longitude" placeholder="e.g.: 37.6173" step="0.0001" value="37.6173">
                <div class="validation-message" id="lonError"></div>
            </div>

            <div class="form-group">
                <label>Search Radius (km)</label>
                <input type="number" id="radius" placeholder="e.g.: 10" min="0.001" max="10000" step="0.001" value="20">
                <div class="validation-message" id="radiusError"></div>
            </div>

            <button id="searchBtn" onclick="window.App.searchObjects()">ğŸ” Find Objects</button>

            <!-- Test Locations -->
            <div class="history" style="margin-top: 15px;">
                <h3 onclick="window.Tests.toggleTestButtons()">
                    <span>ğŸ§ª Test Locations</span>
                    <span id="testButtonsToggleIcon">â–¼</span>
                </h3>
                <div class="history-list" id="testButtonsList" style="display: none;">
                    <button onclick="window.App.setTestLocation()" class="test-btn">
                        ğŸ§ª Test: Washington DC (Pentagon)
                    </button>
                    <button onclick="window.App.setMoscowLocation()" class="test-btn">
                        ğŸ›ï¸ Test: Moscow
                    </button>
                    <button onclick="window.App.setBerlinLocation()" class="test-btn">
                        ğŸ‡©ğŸ‡ª Test: Berlin
                    </button>
                    <button onclick="window.App.testSimpleQuery()" class="test-btn" style="background: #4CAF50;">
                        ğŸ§ª Test Query
                    </button>
                </div>
            </div>

            <div class="filters">
                <h3>ğŸ”§ Filters</h3>
                <div class="filter-item">
                    <input type="checkbox" id="filterMilitary" checked>
                    <label for="filterMilitary">Military Facilities</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="filterHospital" checked>
                    <label for="filterHospital">Military Hospitals</label>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="history">
                <h3 onclick="window.Filters.toggleAdvancedFilters()">
                    <span>âš™ï¸ Advanced Filters</span>
                    <span id="advancedFiltersToggleIcon">â–¼</span>
                </h3>
                <div class="history-list" id="advancedFiltersList" style="display: none;">
                    <div class="filter-item">
                        <input type="checkbox" id="filterNamedOnly">
                        <label for="filterNamedOnly">Named Objects Only</label>
                    </div>
                    <div class="filter-item" style="margin-top: 10px;">
                        <input type="checkbox" id="filterBySize">
                        <label for="filterBySize">Minimum Size Filter</label>
                    </div>
                    <div class="form-group" style="margin-top: 5px; margin-left: 20px;">
                        <label style="font-size: 11px;">Min Area (mÂ²)</label>
                        <input type="number" id="minArea" placeholder="e.g.: 100" min="0" step="10" value="100" disabled>
                    </div>
                    <div class="filter-item" style="margin-top: 10px;">
                        <input type="checkbox" id="filterByDate">
                        <label for="filterByDate">Updated After</label>
                    </div>
                    <div class="form-group" style="margin-top: 5px; margin-left: 20px;">
                        <input type="date" id="minDate" disabled>
                    </div>
                    <div style="margin-top: 10px; font-size: 10px; color: var(--text-secondary); padding: 8px; background: var(--bg-primary); border-radius: 5px;">
                        <strong>ğŸ’¡ Note:</strong> Advanced filters work only with OpenStreetMap data. Size and date filters may reduce results significantly.
                    </div>
                </div>
            </div>

            <!-- Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… -->
            <div class="filters" style="margin-top: 10px;">
                <h3>ğŸŒ Data Sources</h3>
                <div class="filter-item">
                    <input type="checkbox" id="sourceOSM" checked>
                    <label for="sourceOSM">OpenStreetMap (Overpass API)</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="sourceGeoNames">
                    <label for="sourceGeoNames">GeoNames API</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="sourceWikidata">
                    <label for="sourceWikidata">Wikidata API</label>
                </div>
            </div>

            <!-- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ² -->
            <div class="history">
                <h3 onclick="window.History.toggleHistory()">
                    <span>ğŸ“œ Search History</span>
                    <span id="historyToggleIcon">â–¼</span>
                </h3>
                <div class="history-list" id="historyList"></div>
                <button onclick="window.History.clearHistory()" class="secondary-btn" style="margin-top: 10px; display: none;" id="clearHistoryBtn">
                    ğŸ—‘ï¸ Clear History
                </button>
            </div>

            <div class="status" id="statusBox" style="display: none;">
                <h3 style="color: var(--accent); margin-bottom: 10px;">ğŸ“‹ Status</h3>
                <div id="statusList"></div>
            </div>

            <div class="legend">
                <h3>ğŸ“ Legend</h3>
                <div class="legend-item">
                    <div class="marker military"></div>
                    <span>Military Facilities</span>
                </div>
                <div class="legend-item">
                    <div class="marker hospital"></div>
                    <span>Military Hospitals</span>
                </div>
            </div>

            <div class="results">
                <h3>ğŸ“Š Results: <span id="resultCount">0</span></h3>

                <!-- Heatmap Toggle -->
                <div class="filter-item" id="heatmapToggleContainer" style="display: none; margin-bottom: 10px; padding: 10px; background: var(--bg-primary); border-radius: 5px;">
                    <input type="checkbox" id="heatmapToggle" onchange="window.Filters.toggleHeatmap()">
                    <label for="heatmapToggle">ğŸ”¥ Show Heatmap</label>
                </div>

                <div id="resultsList"></div>

                <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° -->
                <button onclick="window.Export.openExportModal()" class="secondary-btn" id="exportBtn" style="display: none; margin-top: 15px;">
                    ğŸ“¥ Export Results
                </button>
            </div>

            <!-- Share ÑĞµĞºÑ†Ğ¸Ñ -->
            <div class="share-section" id="shareSection" style="display: none;">
                <h3>ğŸ”— Share Search</h3>
                <div class="share-url-container">
                    <input type="text" class="share-url-input" id="shareUrl" readonly>
                    <button class="copy-btn" onclick="window.Share.copyShareLink()" id="copyBtn">ğŸ“‹ Copy</button>
                </div>
            </div>

            <div class="info-box" id="activeSourcesBox">
                <strong>ğŸ” Active Data Sources:</strong><br>
                <span id="activeSourcesList">â€¢ OpenStreetMap (Overpass API)</span>
            </div>
        </div>

        <div class="map-container">
            <div class="map-header">
                <span class="app-title">Point Zero OSINT</span>
                <div class="header-buttons">
                    <button class="theme-toggle" onclick="window.Theme.toggleTheme()" id="themeToggle">ğŸŒ™</button>
                    <button class="ai-history-toggle" onclick="window.AIDescriptions.toggleAISidebar(true)" id="aiHistoryToggle" title="AI Descriptions History">ğŸ¤–</button>
                    <button class="settings-toggle" onclick="window.Settings.openSettingsModal()" id="settingsToggle">âš™ï¸</button>
                </div>
            </div>
            <div id="map"></div>
        </div>

        <!-- AI Description Sidebar -->
        <div id="aiDescriptionSidebar" class="ai-sidebar">
            <div class="ai-sidebar-header">
                <h3>ğŸ¤– AI Description</h3>
                <button class="ai-sidebar-close" onclick="window.AIDescriptions.toggleAISidebar(false)">âœ•</button>
            </div>
            <div id="aiDescriptionContent" class="ai-sidebar-content">
                <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                    Click "ğŸ¤– AI Describe" button on any marker to generate description
                </p>
            </div>
        </div>
    </div>

    <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.Export.closeExportModal()">&times;</span>
            <h2 class="modal-header">ğŸ“¥ Export Results</h2>

            <div class="export-format-selector">
                <label>Select Format:</label>
                <select id="exportFormat">
                    <option value="zip">ğŸ“¦ ZIP (All Formats)</option>
                    <option value="csv">CSV (Excel/Sheets)</option>
                    <option value="json">JSON (Programming)</option>
                    <option value="geojson">GeoJSON (GIS)</option>
                    <option value="html">HTML (Report)</option>
                    <option value="txt">TXT (Plain Text)</option>
                    <option value="md">Markdown (Documentation)</option>
                </select>
            </div>

            <div class="form-group">
                <label>File Name:</label>
                <input type="text" id="exportFilename" placeholder="results" value="point_zero_results">
            </div>

            <button onclick="window.Export.executeExport()">ğŸ’¾ Download</button>
            <button onclick="window.Export.closeExportModal()" class="secondary-btn">âŒ Cancel</button>
        </div>
    </div>

    <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.Settings.closeSettingsModal()">&times;</span>
            <h2 class="modal-header">âš™ï¸ Settings</h2>

            <div class="form-group">
                <label>Default Search Radius (km):</label>
                <input type="number" id="defaultRadiusInput" min="0.001" max="10000" step="0.001" value="20">
            </div>

            <div class="filter-item" style="margin-bottom: 15px;">
                <input type="checkbox" id="autoSaveHistoryCheck" checked>
                <label for="autoSaveHistoryCheck">Auto-save Search History</label>
            </div>

            <div class="filter-item" style="margin-bottom: 15px;">
                <input type="checkbox" id="showAdvancedFiltersCheck">
                <label for="showAdvancedFiltersCheck">Show Advanced Filters by Default</label>
            </div>

            <!-- OpenRouter API Settings -->
            <div style="margin-top: 20px; padding: 15px; background: var(--bg-primary); border-radius: 5px; border-left: 3px solid var(--accent);">
                <strong>ğŸ¤– AI Descriptions (OpenRouter API)</strong>
                <p style="font-size: 11px; margin: 8px 0; color: var(--text-secondary);">
                    Generate human-readable descriptions for locations using AI.
                </p>

                <div class="form-group" style="margin-top: 10px;">
                    <label style="font-size: 12px;">OpenRouter API Key:</label>
                    <input type="password" id="aimlApiKeyInput" placeholder="Enter your OpenRouter API key" style="padding: 8px; font-size: 12px;">
                </div>

                <div class="form-group" style="margin-top: 10px;">
                    <label style="font-size: 12px;">AI Model (100% FREE $0):</label>
                    <select id="aimlModelSelect" style="padding: 8px; font-size: 11px; width: 100%; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 5px;">
                        <option value="gemma-3-12b">Gemma 3 12B (Google) - Recommended</option>
                        <option value="gemma-3-27b">Gemma 3 27B (Google) - Larger</option>
                        <option value="deepseek-chimera">DeepSeek R1 Chimera (671B MoE)</option>
                        <option value="mimo-flash">Xiaomi MiMo Flash (Fast)</option>
                    </select>
                </div>

                <button onclick="window.AIDescriptions.testOpenRouterConnectionUI(event)" class="test-btn" style="margin-top: 10px; width: 100%; padding: 8px; font-size: 11px;">
                    ğŸ§ª Test OpenRouter Connection
                </button>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="font-size: 12px;">Custom Prompt (Optional):</label>
                    <textarea id="aiCustomPromptInput" placeholder="Add custom instructions for AI (e.g., 'Focus on security aspects', 'Be brief and technical', etc.)" style="padding: 8px; font-size: 11px; min-height: 60px; width: 100%; font-family: inherit; resize: vertical; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 5px;"></textarea>
                    <div style="margin-top: 5px; font-size: 9px; color: var(--text-secondary);">
                        ğŸ’¡ Customize AI responses with your own instructions
                    </div>
                </div>

                <div style="margin-top: 10px; font-size: 10px; color: var(--text-secondary);">
                    <strong>Setup:</strong><br>
                    1. Register: <a href="https://openrouter.ai/auth" target="_blank" style="color: var(--accent);">openrouter.ai/auth</a><br>
                    2. Get API key: <a href="https://openrouter.ai/settings/keys" target="_blank" style="color: var(--accent);">openrouter.ai/settings/keys</a><br>
                    3. Free models listed above are 100% FREE<br><br>
                    <strong style="color: var(--warning);">âš ï¸ Free Tier Limits:</strong><br>
                    â€¢ <strong>50 requests/day</strong> (no credits)<br>
                    â€¢ <strong>1000 requests/day</strong> (with $10 credits purchased)<br>
                    <em style="font-size: 9px;">Credits are NOT consumed for free models, only unlock higher limits</em>
                </div>
            </div>

            <!-- GeoNames API Settings -->
            <div style="margin-top: 20px; padding: 15px; background: var(--bg-primary); border-radius: 5px; border-left: 3px solid #4CAF50;">
                <strong>ğŸŒ GeoNames API</strong>
                <p style="font-size: 11px; margin: 8px 0; color: var(--text-secondary);">
                    Additional data source for global coverage.
                </p>

                <div class="form-group" style="margin-top: 10px;">
                    <label style="font-size: 12px;">GeoNames Username:</label>
                    <input type="text" id="geonamesUsername" placeholder="Enter your username" style="padding: 8px; font-size: 12px;">
                </div>

                <button onclick="window.Credentials.testGeoNamesConnection()" class="test-btn" style="margin-top: 10px; width: 100%; padding: 8px; font-size: 11px;">
                    ğŸ§ª Test GeoNames Connection
                </button>

                <div style="margin-top: 10px; font-size: 10px; color: var(--text-secondary);">
                    <strong>Setup:</strong><br>
                    1. Register at <a href="http://www.geonames.org/login" target="_blank" style="color: var(--accent);">geonames.org</a><br>
                    2. Confirm email<br>
                    3. Enable "Free Web Services" in <a href="http://www.geonames.org/manageaccount" target="_blank" style="color: var(--accent);">account settings</a><br>
                    4. Wait 5-10 minutes after activation<br>
                    <strong style="color: var(--warning);">âš ï¸ Username is case-sensitive!</strong>
                </div>

                <div style="margin-top: 10px; padding: 8px; background: var(--bg-secondary); border-radius: 5px; font-size: 10px; color: var(--text-secondary);">
                    <strong>ğŸ’¡ Info:</strong> OpenStreetMap and Wikidata don't require API keys<br><br>
                    <strong>ğŸ“Š Data Coverage:</strong><br>
                    â€¢ <strong>OSM</strong> - Best for military facilities<br>
                    â€¢ <strong>GeoNames</strong> - Good global coverage<br>
                    â€¢ <strong>Wikidata</strong> - Limited military data, good for hospitals
                </div>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: var(--bg-primary); border-radius: 5px; border-left: 3px solid var(--warning);">
                <strong>âš ï¸ Reset Settings</strong>
                <p style="font-size: 12px; margin: 8px 0; color: var(--text-secondary);">
                    This will reset all settings to default values. Your search history will NOT be affected.
                </p>
                <button onclick="window.Settings.resetSettings()" class="secondary-btn" style="width: 100%; margin-top: 10px; background: var(--warning);">
                    ğŸ”„ Reset to Default
                </button>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="window.Settings.saveCurrentSettings()" style="flex: 1;">ğŸ’¾ Save Settings</button>
                <button onclick="window.Settings.closeSettingsModal()" class="secondary-btn" style="flex: 1;">âŒ Cancel</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- Leaflet.heat for Heatmap -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <!-- JSZip for ZIP export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Application JS Modules (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½!) -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/logo.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/credentials.js"></script>
    <script src="js/datasources.js"></script>
    <script src="js/history.js"></script>
    <script src="js/share.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/tests.js"></script>
    <script src="js/api.js"></script>
    <script src="js/export.js"></script>
    <script src="js/ai-descriptions.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
