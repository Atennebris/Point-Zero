<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military & Medical Facilities Finder</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>
                <span>ğŸ¯ Search Objects</span>
                <button class="theme-toggle" onclick="window.Theme.toggleTheme()" id="themeToggle">ğŸŒ™</button>
            </h1>

            <div class="form-group">
                <label>Latitude</label>
                <input type="number" id="latitude" placeholder="e.g.: 55.7558" step="0.0001" value="55.7558">
                <div class="validation-message" id="latError"></div>
            </div>

            <div class="form-group">
                <label>Longitude</label>
                <input type="number" id="longitude" placeholder="e.g.: 37.6173" step="0.0001" value="37.6173">
                <div class="validation-message" id="lonError"></div>
            </div>

            <div class="form-group">
                <label>Search Radius (km)</label>
                <input type="number" id="radius" placeholder="e.g.: 10" min="0.001" max="10000" step="0.001" value="20">
                <div class="validation-message" id="radiusError"></div>
            </div>

            <button id="searchBtn" onclick="window.App.searchObjects()">ğŸ” Find Objects</button>

            <button onclick="window.App.setTestLocation()" class="test-btn">
                ğŸ§ª Test: Washington DC (Pentagon)
            </button>
            <button onclick="window.App.setMoscowLocation()" class="test-btn">
                ğŸ›ï¸ Test: Moscow
            </button>
            <button onclick="window.App.setBerlinLocation()" class="test-btn">
                ğŸ‡©ğŸ‡ª Test: Berlin
            </button>
            <button onclick="window.App.testSimpleQuery()" class="test-btn" style="background: #4CAF50;">
                ğŸ§ª Test Query
            </button>

            <div class="filters">
                <h3>ğŸ”§ Filters</h3>
                <div class="filter-item">
                    <input type="checkbox" id="filterMilitary" checked>
                    <label for="filterMilitary">Military Facilities</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="filterHospital" checked>
                    <label for="filterHospital">Military Hospitals</label>
                </div>
            </div>

            <!-- Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… -->
            <div class="filters" style="margin-top: 10px;">
                <h3>ğŸŒ Data Sources</h3>
                <div class="filter-item">
                    <input type="checkbox" id="sourceOSM" checked>
                    <label for="sourceOSM">OpenStreetMap (Overpass API)</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="sourceGeoNames">
                    <label for="sourceGeoNames">GeoNames API</label>
                </div>
                <div class="filter-item">
                    <input type="checkbox" id="sourceWikidata">
                    <label for="sourceWikidata">Wikidata API</label>
                </div>
            </div>

            <!-- API Credentials -->
            <div class="history">
                <h3 onclick="window.Credentials.toggleCredentials()">
                    <span>ğŸ”‘ API Credentials</span>
                    <span id="credentialsToggleIcon">â–¼</span>
                </h3>
                <div class="history-list" id="credentialsList">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="font-size: 12px;">GeoNames Username</label>
                        <input type="text" id="geonamesUsername" placeholder="Enter your username" style="padding: 8px; font-size: 12px;">
                        <button onclick="window.Credentials.testGeoNamesConnection()" class="test-btn" style="margin-top: 8px; width: 100%; padding: 6px; font-size: 11px;">
                            ğŸ§ª Test GeoNames Connection
                        </button>
                        <div style="margin-top: 5px; font-size: 10px; color: var(--text-secondary);">
                            <strong>Setup:</strong><br>
                            1. Register at <a href="http://www.geonames.org/login" target="_blank" style="color: var(--accent);">geonames.org</a><br>
                            2. Confirm email<br>
                            3. Enable "Free Web Services" in <a href="http://www.geonames.org/manageaccount" target="_blank" style="color: var(--accent);">account settings</a><br>
                            4. Wait 5-10 minutes after activation<br>
                            <strong style="color: var(--warning);">âš ï¸ Username is case-sensitive!</strong>
                        </div>
                    </div>
                    <!-- Placeholder Ğ´Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ñ… API ĞºĞ»ÑÑ‡ĞµĞ¹ -->
                    <div style="padding: 8px; background: var(--bg-primary); border-radius: 5px; font-size: 11px; color: var(--text-secondary);">
                        <strong>ğŸ’¡ Info:</strong> OpenStreetMap and Wikidata don't require API keys<br><br>
                        <strong>ğŸ“Š Data Coverage:</strong><br>
                        â€¢ <strong>OSM</strong> - Best for military facilities<br>
                        â€¢ <strong>GeoNames</strong> - Good global coverage<br>
                        â€¢ <strong>Wikidata</strong> - Limited military data, good for hospitals
                    </div>
                </div>
            </div>

            <!-- Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ² -->
            <div class="history">
                <h3 onclick="window.History.toggleHistory()">
                    <span>ğŸ“œ Search History</span>
                    <span id="historyToggleIcon">â–¼</span>
                </h3>
                <div class="history-list" id="historyList"></div>
                <button onclick="window.History.clearHistory()" class="secondary-btn" style="margin-top: 10px; display: none;" id="clearHistoryBtn">
                    ğŸ—‘ï¸ Clear History
                </button>
            </div>

            <div class="status" id="statusBox" style="display: none;">
                <h3 style="color: var(--accent); margin-bottom: 10px;">ğŸ“‹ Status</h3>
                <div id="statusList"></div>
            </div>

            <div class="legend">
                <h3>ğŸ“ Legend</h3>
                <div class="legend-item">
                    <div class="marker military"></div>
                    <span>Military Facilities</span>
                </div>
                <div class="legend-item">
                    <div class="marker hospital"></div>
                    <span>Military Hospitals</span>
                </div>
                <div class="legend-item">
                    <div class="marker" style="background: #2196F3;"></div>
                    <span>Your Position</span>
                </div>
            </div>

            <div class="results">
                <h3>ğŸ“Š Results: <span id="resultCount">0</span></h3>
                <div id="resultsList"></div>

                <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° -->
                <button onclick="window.Export.openExportModal()" class="secondary-btn" id="exportBtn" style="display: none; margin-top: 15px;">
                    ğŸ“¥ Export Results
                </button>
            </div>

            <!-- Share ÑĞµĞºÑ†Ğ¸Ñ -->
            <div class="share-section" id="shareSection" style="display: none;">
                <h3>ğŸ”— Share Search</h3>
                <div class="share-url-container">
                    <input type="text" class="share-url-input" id="shareUrl" readonly>
                    <button class="copy-btn" onclick="window.Share.copyShareLink()" id="copyBtn">ğŸ“‹ Copy</button>
                </div>
            </div>

            <div class="info-box" id="activeSourcesBox">
                <strong>ğŸ” Active Data Sources:</strong><br>
                <span id="activeSourcesList">â€¢ OpenStreetMap (Overpass API)</span>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.Export.closeExportModal()">&times;</span>
            <h2 class="modal-header">ğŸ“¥ Export Results</h2>

            <div class="export-format-selector">
                <label>Select Format:</label>
                <select id="exportFormat">
                    <option value="zip">ğŸ“¦ ZIP (All Formats)</option>
                    <option value="csv">CSV (Excel/Sheets)</option>
                    <option value="json">JSON (Programming)</option>
                    <option value="geojson">GeoJSON (GIS)</option>
                    <option value="html">HTML (Report)</option>
                    <option value="txt">TXT (Plain Text)</option>
                    <option value="md">Markdown (Documentation)</option>
                </select>
            </div>

            <div class="form-group">
                <label>File Name:</label>
                <input type="text" id="exportFilename" placeholder="results" value="point_zero_results">
            </div>

            <button onclick="window.Export.executeExport()">ğŸ’¾ Download</button>
            <button onclick="window.Export.closeExportModal()" class="secondary-btn">âŒ Cancel</button>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- JSZip for ZIP export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Application JS Modules (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½!) -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/credentials.js"></script>
    <script src="js/datasources.js"></script>
    <script src="js/history.js"></script>
    <script src="js/share.js"></script>
    <script src="js/api.js"></script>
    <script src="js/export.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
